<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/layout}">

  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="crossorigin"/>
    <link href="https://fonts.googleapis.com/css2?family=Poetsen+One&display=swap" rel="stylesheet"/>
    <th:block layout:fragment="css">
      <link rel="stylesheet" th:href="@{/css/animal-review.css}">
    </th:block>
  </head>

  <body>
    <div layout:fragment="content">
      <section class="hero-wrap hero-wrap-2" style="background-image: url('images/bg_2.jpg');" data-stellar-background-ratio="0.5">
        <div class="overlay"></div>
        <div class="container">
          <div class="row no-gutters slider-text align-items-end">
            <div class="col-md-9 ftco-animate pb-5">
              <p class="breadcrumbs mb-2">
                <span class="mr-2">
                  <a th:href="@{/}">Home
                    <i class="ion-ios-arrow-forward"></i>
                  </a>
                </span>
                <span class="mr-2">
                  <a th:href="@{/missing/list}">실종·신고게시판
                    <i class="ion-ios-arrow-forward"></i>
                  </a>
                </span>
              </p>
              <h1 class="mb-0 bread">[[${dto.title}]]</h1>
            </div>
          </div>
        </div>
      </section>

      <section class="ftco-section ftco-degree-bg">
        <div class="container justify-content-center">
          <div class="row">
            <div class="col-lg-8 ftco-animate">
              <p>
                <img src="images/image_1.jpg" alt="" class="img-fluid">
              </p>
              <div class="uploadResult mb-4">
                <h2 th:text="${dto.title}"></h2>
                <ul>
                  <li th:each="image : ${dto.missingImageDtos}" th:attr="data-file=${image.getImageURL()}" style="list-style-type: none;">
                    <img class="img-fluid block onebonimg" th:if="${image.path != null}" th:src="|/upload/display?fileName=${image.getImageURL()}|"/>
                  </li>
                </ul>
              </div>
              <div>
                <p class="text-break" th:text="${dto.text}"></p>
              </div>
              <div class="tag-widget post-tag-container mb-5 mt-5" sec:authorize="hasRole('ROLE_MEMBER')" th:if="${#authentication.principal.memberDto.email == dto.email}">
                <div class="">
                  <a th:href="@{/missing/modify(missno=${dto.missno},page=${requestDto.page}, type=${requestDto.type}, keyword=${requestDto.keyword})}" class="btn btn-warning">수정</a>
                  <a href="" class="btn btn-danger">삭제</a>
                  <a th:href="@{/missing/list(page=${requestDto.page}, type=${requestDto.type}, keyword=${requestDto.keyword})}" class="btn btn-primary">목록</a>
                </div>
                <form method="post" id="actionForm" th:action="@{/missing/remove}">
                  <input type="hidden" name="missno" th:value="${dto.missno}"/>
                  <input type="hidden" name="page" th:value="${requestDto.page}"/>
                  <input type="hidden" name="type" th:value="${requestDto.type}"/>
                  <input type="hidden" name="keyword" th:value="${requestDto.keyword}"/>
                </form>
              </div>

              <!-- 댓글 생성 -->
              <div class="MissingReview">
                <div class="comment-form-wrap pt-5">
                  <h3 class="review-cnt" th:text="${dto.replyCount}"></h3>
                  <form th:action="@{/missingreply/}" method="post" id="replyForm" name="replyForm" class="p-5 bg-light" sec:authorize="hasRole('ROLE_MEMBER')">
                    <input type="hidden" name="mid" id="mid" th:value="${#authentication.principal.memberDto.mid}"/>
                    <input type="hidden" name="email" id="email" th:value="${#authentication.principal.memberDto.email}"/>
                    <input type="hidden" name="missno" id="missno" th:value="${dto.missno}"/>
                    <input type="hidden" name="missrno" id="missrno"/>
                    <div class="form-group">
                      <label for="email">이메일</label>
                      <input type="email" class="form-control" name="email" id="email" th:value="${#authentication.principal.memberDto.email}"/>
                    </div>

                    <div class="form-group">
                      <label for="text">내용</label>
                      <textarea name="text" id="text" cols="30" rows="3" class="form-control"></textarea>
                    </div>
                    <div class="form-group">
                      <input type="submit" value="등록" class="btn py-3 px-4 btn-primary"/>
                    </div>
                  </form>
                </div>
              </div>
              <!-- 댓글 영역 -->
              <div class="pt-5 mt-5 reviewList" id="reviewList">
                <div class="mb-5"></div>
              </div>
            </div>
            <!-- END comment-list -->
          </div>
        </div>
      </section>
    </div>
    <th:block layout:fragment="script">
      <script>
        // csrf 토큰 설정
        const csrfValue = '[[${_csrf.token}]]';

        // 입양등록 번호 변수에 담기
        const missno = "[[${dto.missno}]]";

        // 리뷰 영역 찾기
        const reviewList = document.querySelector(".reviewList");

        const mid = "[[${#authentication.principal}eq('anonymousUser') ? 'anonymousUser' : ${#authentication.principal.memberDto.mid}]]"
        const nickname = "[[${#authentication.principal}eq('anonymousUser') ? 'anonymousUser' : ${#authentication.principal.memberDto.nickname}]]"

        // 로그인 유저
        const user = "[[${#authentication.name}]]";
      </script>

      <script th:src="@{/js/missingmodify.js}"></script>
      <script th:src="@{/js/missingreply.js}"></script>
    </th:block>
  </body>
</html>
